(function(p){function m(a,e,c){var b=c;void 0===b&&(b={});a=a.toUpperCase();c="charset"in b?b.charset:m.defaults.charset;var h="mimeType"in b?b.mimeType:m.defaults.mimeType,d=b.data,g=[],k={};n(m.defaults.headers).forEach(function(a){k[a]=m.defaults.headers[a]});n(b.headers||{}).forEach(function(a){k[a]=b.headers[a]});"[object Object]"===q.call(d)&&(n(d).forEach(function(a){var c=encodeURIComponent,b=c(a);a=d[a];u(a)?a.forEach(function(a){g.push(b+"="+encodeURIComponent(a))}):g.push(b+"="+c(a))}),
"GET"===a?d=null:(d=g.join("&").replace(/%20/g,"+"),g=[]));"string"===typeof d&&("GET"===a?(g.push(d),d=null):k["Content-Type"]="application/x-www-form-urlencoded");"[object Object]"===q.call(b.json)&&(d=JSON.stringify(b.json),k["Content-Type"]="application/json");"Content-Type"in k&&(k["Content-Type"]+="; charset="+c);!b.emulateHTTP||"PUT"!==a&&"DELETE"!==a&&"PATCH"!==a&&"POST"!==a&&"GET"!==a||(g.push(b.emulateHTTP+"="+a),k["X-Http-Method-Override"]=a,a="POST");g.length&&(e+=(~e.indexOf("?")?"&":
"?")+g.join("&").replace(/%20/g,"+"));var f=b.xhr||new XMLHttpRequest;c=new r(function(c,g){var l=function(a){return function(){g(Error(a))}};f.open(a,e,!0);f.timeout=b.timeout||m.defaults.timeout;b.before&&b.before(f);for(var n in k){var p=k[n];null!=p&&f.setRequestHeader(n,String(p))}h&&(h in t?(f.responseType=h,h=t[h]):f.overrideMimeType&&f.overrideMimeType(h));f.onabort=l("abort");f.onerror=l("error");f.ontimeout=l("timeout");f.onreadystatechange=function(){if(4===f.readyState){h=h||f.getResponseHeader("Content-Type")||
"";var a="response"in f?f.response:f.responseText,b=v[h.split(";")[0]];if(b)try{a=b(a)}catch(d){return g(d)}c(a)}};f.send(d||null)});c[0]=f;return c}var r=window.Promise,u=Array.isArray,n=Object.keys,q=Object.prototype.toString,t={json:"application/json"},v={"application/json":function(a){return JSON.parse(a)}},l=function(a){return function(e,c){return m(a,e,c)}};window.ugma||console.warn("ugma javascript Framework need to be included");r||p.minErr("XHR()","In order to use XHR you have to include a Promise polyfill");
m.defaults={timeout:15E3,charset:"UTF-8",headers:{"X-Requested-With":"XMLHttpRequest"}};p.extend({XHR:m,post:l("post"),get:l("get"),put:l("put"),"delete":l("delete"),patch:l("patch"),serialize:function(a){var e={};a="form"in a?[a]:"elements"in a?a.elements:[];for(var c,b=0,h=a.length;b<h;){c=a[b++];var d=c.name;if(!c.disabled&&d)switch(c.type){case "select-multiple":e[d]=[];case "select-one":for(var g=c.options,b=0,h=g.length;b<h;)c=g[b++],c.selected&&(d in e?e[d].push(c.value):e[d]=c.value);break;
case void 0:case "fieldset":case "file":case "image":case "submit":case "reset":case "button":break;case "textarea":e[d].push(c.value.replace(/\r?\n/g,"\r\n"));case "checkbox":if(c.checked&&e[d]){"string"===typeof e[d]&&(e[d]=[e[d]]);e[d].push(c.value);break}case "radio":if(!c.checked)break;default:e[d]=c.value}}return e}})})(window.ugma);